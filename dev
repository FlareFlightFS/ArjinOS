import PySimpleGUI as sg
import hashlib

pin_file = 'pin_hash.txt'
status_file = 'status.txt'

def hash_pin(pin):
    return hashlib.sha256(pin.encode()).hexdigest()


def reset_pin():
    layout_reset = [
        [sg.Text('Enter a new PIN:', font=('Arial', 24), text_color='white', background_color='black')],
        [sg.InputText(key='-NEWPIN-', password_char='*', font=('Arial', 24), size=(30, 1))],
        [sg.Button('Submit', font=('Arial', 24))]
    ]
    window_reset = sg.Window('Reset PIN', layout_reset, finalize=True, size=(1080, 1920), background_color='black')

    while True:
        event, values = window_reset.read()
        if event == sg.WINDOW_CLOSED:
            break
        if event == 'Submit':
            new_pin = values['-NEWPIN-']
            if new_pin:
                hashed_pin = hash_pin(new_pin)
                with open(pin_file, 'w') as f:
                    f.write(hashed_pin)
                sg.popup('PIN reset successfully!', font=('Arial', 24), background_color='black')
                break
    window_reset.close()

def change_hash_display():
    with open(pin_file, 'r') as f:
        data = f.read().strip()
    if data.isdigit():
        hashed_data = hash_pin(data)
        with open(pin_file, 'w') as f:
            f.write(hashed_data)
    else:
        with open(status_file, 'r') as f:
            original_pin = f.read().strip()
        with open(pin_file, 'w') as f:
            f.write(original_pin)

layout_dev = [
    [sg.Button('CHANGE HASH TO NUMBER FORM', font=('Arial', 24))],
    [sg.Button('BOOT RESET', font=('Arial', 24))],
    [sg.Button('CHANGE PASSWORD', font=('Arial', 24))]
]

window_dev = sg.Window('Developer Mode', layout_dev, finalize=True, size=(1080, 1920), background_color='black')

while True:
    event, values = window_dev.read()
    if event == sg.WINDOW_CLOSED:
        break
    if event == 'CHANGE HASH TO NUMBER FORM':
        change_hash_display()
    if event == 'BOOT RESET':
        if sg.popup_yes_no('ARE YOU SURE YOU WANT TO RESET DEVICE?', font=('Arial', 24), background_color='black') == 'Yes':
            with open(status_file, 'w') as f:
                f.write('0')
    if event == 'CHANGE PASSWORD':
        reset_pin()

window_dev.close()
